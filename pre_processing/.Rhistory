400/4000
0.1*60
library(readr)
library(rbenchmark)
benchmark({getGeoData("325 Sharon Park Dr. Menlo Park CA 94025")}, replications = 5)
0.59/5
benchmark({getGeoData("325 Sharon Park Dr. Menlo Park CA 94025")}, replications = 10)
1.12/10
addrs <- read_csv("addresses_only.csv")
View(addrs)
addrs <- read_csv("addresses_only.csv")
View(addrs)
test$results[[1]]$geometry$location
test$results[[1]]$geometry$location
# modified to return the vector of lat long
getGeoData <- function(location){
location <- gsub(' ','+',location)
geo_data <- getURL(paste("https://maps.googleapis.com/maps/api/geocode/json?address=",location,"&key=AIzaSyDkJJ2brMHagmb2mmOGNXQgkT71QUwRLgU", sep=""))
raw_data_2 <- fromJSON(geo_data)
# return(raw_data_2)
return(raw_data_2$results[[1]]$geometry$location)
}
getGeoData("325 Sharon Park Dr. Menlo Park CA 94025")
?lapply
View(addrs)
geocodes <- lapply(addrs$service_address, getGeoData)
geocodes <- data.frame("geocode" = rep(NA, nrow(addrs)))
geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
View(geocodes)
# modified to return the vector of lat long
getGeoData <- function(location){
location <- gsub(' ','+',location)
geo_data <- getURL(paste("https://maps.googleapis.com/maps/api/geocode/json?address=",location,"&key=AIzaSyDkJJ2brMHagmb2mmOGNXQgkT71QUwRLgU", sep=""))
raw_data_2 <- fromJSON(geo_data)
return(raw_data_2)
# Sys.sleep()
# return(raw_data_2$results[[1]]$geometry$location)
}
test <- getGeoData("325 Sharon Park Dr. Menlo Park CA 94025")
test$status
temp <- getGeoData(addrs$service_address[1]
temp <- getGeoData(addrs$service_address[1])
temp$status
temp$status == "OK"
temp$results[[1]]$geometry$location
temp$results[[1]]$geometry$location[[1]]
temp$results[[1]]$geometry$location[[2]]
print(paste(i, temp$status))
i = 1
print(paste(i, temp$status))
rm(i)
geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
for (i in 1:nrow(addrs)) {
temp <- getGeoData(addrs$service_address[i])
print(paste(i, temp$status))
if (temp$status == "OK") {
geocodes$lat[i] <- temp$results[[1]]$geometry$location[[1]]
geocodes$lng[i] <- temp$results[[1]]$geometry$location[[2]]
} else {
geocodes$lat[i] <- NA
geocodes$lng[i] <- NA
}
}
View(cbind(addrs, geocodes))
# geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
for (i in 204) {
temp <- getGeoData(addrs$service_address[i])
print(paste(i, temp$status))
if (temp$status == "OK") {
geocodes$lat[i] <- temp$results[[1]]$geometry$location[[1]]
geocodes$lng[i] <- temp$results[[1]]$geometry$location[[2]]
} else {
geocodes$lat[i] <- NA
geocodes$lng[i] <- NA
}
}
# geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
for (i in 239) {
temp <- getGeoData(addrs$service_address[i])
print(paste(i, temp$status))
if (temp$status == "OK") {
geocodes$lat[i] <- temp$results[[1]]$geometry$location[[1]]
geocodes$lng[i] <- temp$results[[1]]$geometry$location[[2]]
} else {
geocodes$lat[i] <- NA
geocodes$lng[i] <- NA
}
}
# geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
for (i in 290) {
temp <- getGeoData(addrs$service_address[i])
print(paste(i, temp$status))
if (temp$status == "OK") {
geocodes$lat[i] <- temp$results[[1]]$geometry$location[[1]]
geocodes$lng[i] <- temp$results[[1]]$geometry$location[[2]]
} else {
geocodes$lat[i] <- NA
geocodes$lng[i] <- NA
}
}
# geocodes <- data.frame("lat" = rep(NA, nrow(addrs)), "lng" = rep(NA, nrow(addrs)))
for (i in 310) {
temp <- getGeoData(addrs$service_address[i])
print(paste(i, temp$status))
if (temp$status == "OK") {
geocodes$lat[i] <- temp$results[[1]]$geometry$location[[1]]
geocodes$lng[i] <- temp$results[[1]]$geometry$location[[2]]
} else {
geocodes$lat[i] <- NA
geocodes$lng[i] <- NA
}
}
geocoded_addrs <- cbind(addrs, geocodes)
View(geocoded_addrs)
write_csv(geocoded_addrs, "geocoded_addrs.csv")
getwd(0)
getwd()
save.image()
getwd()
rm(list = ls())
setwd("C:\\Users\\Derek\\Documents\\GitHub\\sonoma_dashboard\\pre_processing")
load(".RData")
library(googlesheets)
library(dplyr)
library(revgeo)
library(rgdal)
library(sp)
library(leaflet)
library(rgeos)
library(rbenchmark)
View(parcel_centers.coords)
View(parcel_data)
parcel_data$area_sqf <- parcel_data$area_m2*10.7639
adu_type <- function(area) {
if (area > 7500) {
return("detached")
} else if (area > 5400) {
return("attached")
} else {
return("none")
}
}
parcel_data$adu_type <- unlist(lapply(parcel_data$area_sqf, adu_type))
View(parcel_data)
dim(data.shape)
View(data.shape@data)
parcel_data.shape <- data.shape
parcel_data.shape
dim(parcel_data.shape)
parcel_data.shape@data <- parcel_data.shape@data %>% subset(select = APN)
View(parcel_data.shape@data)
parcel_data.shape@data <- parcel_data.shape@data %>% left_join(parcel_data, by = "APN")
View(parcel_data.shape@data)
plot(parcel_centers.shape)
plot(data.shape)
plot(parcel_data.shape)
plot(parcel_data.shape)
save(parcel_data, file = "parcel_data.RData")
View(parcel_centers.coords)
parcel_data.shape@data <- parcel_data.shape@data %>% left_join(parcel_data, by = "APN") %>% left_join(y = {subset(parcel_centers.coords, select = c(APN, address))}, by = "APN")
View(parcel_data.shape@data)
parcel_data.shape <- data.shape
parcel_data.shape@data <- parcel_data.shape@data %>% subset(select = APN)
parcel_data.shape@data <- parcel_data.shape@data %>% left_join(parcel_data, by = "APN") %>% left_join(y = {subset(parcel_centers.coords, select = c(APN, address))}, by = "APN")
View(parcel_data.shape@data)
save(parcel_data, file = "parcel_data.RData")
save(parcel_data.shape, file = "parcel_data.RData")
View(parcel_data.shape@data)
setwd("C:\\Users\\Derek\\Documents\\GitHub\\sonoma_dashboard\\pre_processing")
rm(list = ls())
load(".RData")
key <- secret_key_finder()
key
knitr::opts_chunk$set(echo = TRUE)
setwd("C:\\Users\\Derek\\Documents\\GitHub\\sonoma_dashboard\\pre_processing")
rm(list = ls())
load(".RData")
data.shape.bldg <- readOGR(dsn='./epabldg', layer = "epabldg")
# library(googlesheets)
library(dplyr)
# library(revgeo)
library(rgdal)
library(sp)
library(leaflet)
# library(rgeos)
library(rbenchmark)
data.shape.bldg <- readOGR(dsn='./epabldg', layer = "epabldg")
path.expand()
path.expand('./epabldg')
getwd()
setwd("C:\\Users\\Derek\\Documents\\GitHub\\epa_dashboard\\pre_processing")
data.shape.bldg <- readOGR(dsn='./epabldg', layer = "epabldg")
plot(data.shape.bldg)
View(data.shape.bldg@data)
plot(data.shape)
View(data.shape)
View(data.shape@data)
dim(readOGR(dsn='./epaparcels', layer = "epaparcelsuit2"))
dim(data.shape.bldg)
library(rgeos)
library(ggplot2)
data.shape.bldg@proj4string
library(rgeos)
class(data.shape)
install.packages("raster")
library(raster)
plot(intersect(data.shape.bldg, data.shape))
plot(data.shape.bldg)
data.shape.bldg.sfr <- intersect(data.shape.bldg, data.shape)
# Just comparing the two
par(mfrow=c(1,2))
plot(data.shape.bldg)
plot(data.shape.bldg.sfr)
View(data.shape@data)
View(parcel_centers.shape@data)
View(parcel_data.shape@data)
dim(data.shape.bldg.sfr)
dim(data.shape.bldg)
View(data.shape.bldg@data)
View(data.shape.bldg@data[, c("Height")])
View(data.shape.bldg@data[, 2:4])
data.shape.bldg.sfr <- data.shape.bldg
data.shape.bldg.sfr@data <- data.shape.bldg.sfr@data[,2:4]
View(data.shape.bldg.sfr@data)
data.shape.bldg.sfr@polygons
View(data.shape.bldg@data)
library(ggplot2)
qplot(x = data.shape.bldg.sfr@data$bldgarea, geom = "hist")
qplot(x = data.shape.bldg.sfr@data$bldgarea, geom = "histogram")
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50)
summary(data.shape.bldg.sfr@data$bldgarea)
summary(data.shape.bldg.sfr@data$bldgarea)
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,5000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,6000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,6000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,7000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,9000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,10000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,11000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,12000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,13000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,14000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 50) + xlim(c(0,15000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 30) + xlim(c(0,15000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 30) + xlim(c(0,10000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgarea), binwidth = 30) + xlim(c(0,9000))
# Building perimeter
summary(data.shape.bldg.sfr@data$bldgperim)
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgperim), binwidth = 30)
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgperim), binwidth = 30) + xlim(c(0,1000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgperim), binwidth = 15) + xlim(c(0,1000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgperim), binwidth = 10) + xlim(c(0,1000))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$bldgperim), binwidth = 5) + xlim(c(0,1000))
23464.7941/1059.37961
# Building area/perimeter
summary(data.shape.bldg.sfr@data$areaperim)
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$areaperim), binwidth = 5)
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$areaperim), binwidth = 5) + xlim(c(0,60))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$areaperim), binwidth = 30) + xlim(c(0,60))
ggplot() + geom_histogram(aes(x = data.shape.bldg.sfr@data$areaperim), binwidth = 1) + xlim(c(0,60))
library(leaflet)
# library(googlesheets)
library(dplyr)
# library(revgeo)
library(rgdal)
library(sp)
library(leaflet)
library(rgeos)
library(rbenchmark)
library(ggplot2)
library(raster)
library(leaflet)
data.shape.clusters <- readOGR(dsn= "./epaBldgsGroups", layer = "epaBldgsGroups")
View(data.shape.clusters@data)
data.shape.clusters@data %>% group_by(SS_GROUP) %>% summarize(bldgarea)
data.shape.clusters@data %>% group_by(SS_GROUP) %>% summarize(mean(bldgarea))
data.shape.clusters@data %>% group_by(SS_GROUP) %>% summarize(mean(bldgarea), mean(areaperim))
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~SS_GROUP,weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
library(RColorBrewer)
pal <- colorNumeric(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorNumeric(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- colorNumeric(
#     palette = "Set1",
#     domain = data.shape.clusters@data$SS_GROUP)
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=SS_GROUP,weight = 1) %>%
addLegend("bottomright", pal = "Set1", values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
# pal <- colorNumeric(
#     palette = "Set1",
#     domain = data.shape.clusters@data$SS_GROUP)
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~SS_GROUP,weight = 1) %>%
addLegend("bottomright", pal = "Set1", values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
# pal <- colorNumeric(
#     palette = "Set1",
#     domain = data.shape.clusters@data$SS_GROUP)
pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
# pal <- colorNumeric(
#     palette = "Set1",
#     domain = data.shape.clusters@data$SS_GROUP)
pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "New Scores",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
data.shape.clusters@data %>% group_by(SS_GROUP) %>% summarize("area" = mean(bldgarea), "perimeter" = mean(bldgperim))
View(parcel_data)
View(parcel_data)
View(parcel_data)
View(parcel_centers.coords)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles(providers$Stamen.Toner) %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
names(providers)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles(providers$CartoDB.Positron) %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles(providers$Stamen.Toner) %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
names(providers)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles(providers$OpenMapSurfer.Grayscale) %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addTiles() %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
pal <- colorFactor(
palette = "Set1",
domain = data.shape.clusters@data$SS_GROUP)
# pal <- brewer.pal(n = 4, "Set1")
leaflet(data.shape.clusters) %>%
addProviderTiles(providers$Stamen.Toner) %>%
addPolygons(stroke = TRUE,opacity = 1,fillOpacity = 0.9, smoothFactor = 0.5,
color=~pal(SS_GROUP),weight = 1) %>%
addLegend("bottomright", pal = pal, values = ~SS_GROUP,
title = "Group",
labFormat = labelFormat(prefix = ""),
opacity = 1
)
View(data.shape.clusters@data)
# library(googlesheets)
library(dplyr)
# library(revgeo)
library(rgdal)
library(sp)
library(leaflet)
library(rgeos)
library(rbenchmark)
library(ggplot2)
# library(raster)
library(leaflet)
library(RColorBrewer)
data.shape.clusters@proj4string
data.shape@proj4string
data.shape.joined <- over(data.shape.bldg, data.shape)
View(data.shape.joined)
dim(over(data.shape, data.shape.bldg))
View(over(data.shape, data.shape.bldg))
data.shape.joined <- over(data.shape.bldg, data.shape, returnList = TRUE)
class(data.shape.joined)
data.shape.joined[[1]]
View(data.shape.joined)
data.shape.joined <- over(data.shape.bldg, data.shape, returnList = FALSE)
View(data.shape.joined)
class(data.shape.joined)
library(maptools)
class(spCbind(data.shape.bldg, data.shape.joined))
# library(googlesheets)
library(dplyr)
# library(revgeo)
library(rgdal)
library(sp)
library(leaflet)
library(rgeos)
library(rbenchmark)
library(ggplot2)
# library(raster)
library(leaflet)
library(RColorBrewer)
library(maptools)
View(data.shape.clusters)
View(data.shape.clusters@data)
data.shape.joined <- over(data.shape.clusters, data.shape, returnList = FALSE)
View(data.shape.joined)
unique(data.shape@data$LU_Desc)
data.shape.joined <- cbind(data.shape.joined$LU_Desc, data.shape.clusters@data)
data.shape.joined <- data.shape.joined[complete.cases(data.shape.joined$`data.shape.joined$LU_Desc`),]
